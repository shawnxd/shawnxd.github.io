<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .table { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; rx: 5; }
      .pk { fill: #4caf50; stroke: #388e3c; stroke-width: 1; rx: 3; }
      .fk { fill: #ff9800; stroke: #f57c00; stroke-width: 1; rx: 3; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
      .relationship { font-family: Arial, sans-serif; font-size: 10px; fill: #666; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="700" fill="white"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" class="title">Chat System Database Schema</text>
  
  <!-- Users Table -->
  <rect x="50" y="60" width="200" height="120" class="table"/>
  <text x="150" y="80" text-anchor="middle" class="title">users</text>
  <rect x="60" y="90" width="180" height="20" class="pk"/>
  <text x="70" y="103" class="text">id UUID PRIMARY KEY</text>
  <rect x="60" y="110" width="180" height="20"/>
  <text x="70" y="123" class="text">username VARCHAR(50) UNIQUE</text>
  <rect x="60" y="130" width="180" height="20"/>
  <text x="70" y="143" class="text">display_name VARCHAR(100)</text>
  <rect x="60" y="150" width="180" height="20"/>
  <text x="70" y="163" class="text">profile_picture_url TEXT</text>
  <rect x="60" y="170" width="180" height="20"/>
  <text x="70" y="183" class="text">last_seen TIMESTAMP</text>
  
  <!-- Conversations Table -->
  <rect x="300" y="60" width="200" height="100" class="table"/>
  <text x="400" y="80" text-anchor="middle" class="title">conversations</text>
  <rect x="310" y="90" width="180" height="20" class="pk"/>
  <text x="320" y="103" class="text">id UUID PRIMARY KEY</text>
  <rect x="310" y="110" width="180" height="20"/>
  <text x="320" y="123" class="text">type VARCHAR(20)</text>
  <rect x="310" y="130" width="180" height="20"/>
  <text x="320" y="143" class="text">name VARCHAR(255)</text>
  <rect x="310" y="150" width="180" height="20"/>
  <text x="320" y="163" class="text">created_by UUID</text>
  
  <!-- Conversation Participants Table -->
  <rect x="550" y="60" width="200" height="80" class="table"/>
  <text x="650" y="80" text-anchor="middle" class="title">conversation_participants</text>
  <rect x="560" y="90" width="180" height="20" class="pk"/>
  <text x="570" y="103" class="text">conversation_id UUID</text>
  <rect x="560" y="110" width="180" height="20" class="pk"/>
  <text x="570" y="123" class="text">user_id UUID</text>
  <rect x="560" y="130" width="180" height="20"/>
  <text x="570" y="143" class="text">joined_at TIMESTAMP</text>
  
  <!-- Messages Table -->
  <rect x="50" y="220" width="200" height="120" class="table"/>
  <text x="150" y="240" text-anchor="middle" class="title">messages</text>
  <rect x="60" y="250" width="180" height="20" class="pk"/>
  <text x="70" y="263" class="text">id UUID PRIMARY KEY</text>
  <rect x="60" y="270" width="180" height="20" class="fk"/>
  <text x="70" y="283" class="text">conversation_id UUID</text>
  <rect x="60" y="290" width="180" height="20" class="fk"/>
  <text x="70" y="303" class="text">sender_id UUID</text>
  <rect x="60" y="310" width="180" height="20"/>
  <text x="70" y="323" class="text">content TEXT</text>
  <rect x="60" y="330" width="180" height="20"/>
  <text x="70" y="343" class="text">message_type VARCHAR(20)</text>
  
  <!-- Message Status Table -->
  <rect x="300" y="220" width="200" height="100" class="table"/>
  <text x="400" y="240" text-anchor="middle" class="title">message_status</text>
  <rect x="310" y="250" width="180" height="20" class="pk"/>
  <text x="320" y="263" class="text">message_id UUID</text>
  <rect x="310" y="270" width="180" height="20" class="pk"/>
  <text x="320" y="283" class="text">recipient_id UUID</text>
  <rect x="310" y="290" width="180" height="20"/>
  <text x="320" y="303" class="text">status VARCHAR(20)</text>
  <rect x="310" y="310" width="180" height="20"/>
  <text x="320" y="323" class="text">updated_at TIMESTAMP</text>
  
  <!-- Device Sessions Table -->
  <rect x="550" y="220" width="200" height="100" class="table"/>
  <text x="650" y="240" text-anchor="middle" class="title">device_sessions</text>
  <rect x="560" y="250" width="180" height="20" class="pk"/>
  <text x="570" y="263" class="text">session_id UUID PRIMARY KEY</text>
  <rect x="560" y="270" width="180" height="20" class="fk"/>
  <text x="570" y="283" class="text">user_id UUID</text>
  <rect x="560" y="290" width="180" height="20"/>
  <text x="570" y="303" class="text">device_type VARCHAR(50)</text>
  <rect x="560" y="310" width="180" height="20"/>
  <text x="570" y="323" class="text">is_active BOOLEAN</text>
  
  <!-- Media Table -->
  <rect x="50" y="380" width="200" height="80" class="table"/>
  <text x="150" y="400" text-anchor="middle" class="title">media</text>
  <rect x="60" y="410" width="180" height="20" class="pk"/>
  <text x="70" y="423" class="text">id UUID PRIMARY KEY</text>
  <rect x="60" y="430" width="180" height="20" class="fk"/>
  <text x="70" y="443" class="text">message_id UUID</text>
  <rect x="60" y="450" width="180" height="20"/>
  <text x="70" y="463" class="text">url TEXT</text>
  
  <!-- Groups Table -->
  <rect x="300" y="380" width="200" height="80" class="table"/>
  <text x="400" y="400" text-anchor="middle" class="title">groups</text>
  <rect x="310" y="410" width="180" height="20" class="pk"/>
  <text x="320" y="423" class="text">id UUID PRIMARY KEY</text>
  <rect x="310" y="430" width="180" height="20"/>
  <text x="320" y="443" class="text">name VARCHAR(255)</text>
  <rect x="310" y="450" width="180" height="20"/>
  <text x="320" y="463" class="text">description TEXT</text>
  
  <!-- Relationships -->
  <!-- Users to Conversations -->
  <line x1="250" y1="120" x2="300" y2="120" class="arrow"/>
  <text x="275" y="115" class="relationship">1:N</text>
  
  <!-- Conversations to Messages -->
  <line x1="400" y1="160" x2="250" y2="220" class="arrow"/>
  <text x="325" y="190" class="relationship">1:N</text>
  
  <!-- Users to Messages -->
  <line x1="150" y1="180" x2="250" y2="300" class="arrow"/>
  <text x="200" y="240" class="relationship">1:N</text>
  
  <!-- Messages to Message Status -->
  <line x1="250" y1="300" x2="300" y2="300" class="arrow"/>
  <text x="275" y="295" class="relationship">1:N</text>
  
  <!-- Users to Message Status -->
  <line x1="150" y1="180" x2="400" y2="300" class="arrow"/>
  <text x="275" y="240" class="relationship">1:N</text>
  
  <!-- Users to Device Sessions -->
  <line x1="150" y1="180" x2="550" y2="300" class="arrow"/>
  <text x="350" y="240" class="relationship">1:N</text>
  
  <!-- Messages to Media -->
  <line x1="250" y1="340" x2="250" y2="380" class="arrow"/>
  <text x="260" y="360" class="relationship">1:N</text>
  
  <!-- Conversations to Groups -->
  <line x1="500" y1="120" x2="400" y2="380" class="arrow"/>
  <text x="450" y="250" class="relationship">1:1</text>
  
  <!-- Legend -->
  <rect x="50" y="500" width="900" height="180" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
  <text x="500" y="520" text-anchor="middle" class="title">Database Relationships</text>
  
  <text x="80" y="550" class="text">• <strong>Primary Key (PK)</strong>: Unique identifier for each record</text>
  <text x="80" y="570" class="text">• <strong>Foreign Key (FK)</strong>: References to other tables</text>
  <text x="80" y="590" class="text">• <strong>1:N</strong>: One-to-many relationship</text>
  <text x="80" y="610" class="text">• <strong>1:1</strong>: One-to-one relationship</text>
  <text x="80" y="630" class="text">• <strong>users</strong>: Stores user profiles and authentication data</text>
  <text x="80" y="650" class="text">• <strong>conversations</strong>: Defines chat sessions (1-on-1 or group)</text>
  <text x="80" y="670" class="text">• <strong>messages</strong>: Stores all message content and metadata</text>
  <text x="80" y="690" class="text">• <strong>message_status</strong>: Tracks delivery and read status per recipient</text>
</svg> 